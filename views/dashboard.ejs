<!DOCTYPE html>
<html>
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<title>Dashboard</title>
<%-include('partials/header')%>
<style>
    /* Defina um layout para a dashboard */
.dashboard-container {
    display: flex; /* Flexbox para facilitar o layout lado a lado */
    height: 100vh;
}

/* Barra lateral */
.barraLateral {
    width: 250px; /* Ajuste a largura da barra lateral */
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    background-color: #2c3e50;
    color: white;
    padding-top: 20px;
}

/* Área principal */
.main-content {
    margin-left: 250px; /* Deixe um espaço para a barra lateral */
    width: calc(100% - 250px); /* Certifique-se que a área principal ocupe o restante da largura */
    padding: 20px;
    overflow: auto; /* Garante que o conteúdo não ultrapasse a área */
}

/* DataTable */
#Datatable {
    width: 100%;
    table-layout: auto; /* Deixe a tabela se ajustar automaticamente */
    margin-top: 20px;
}

/* Evitar que o DataTable ultrapasse os limites do contêiner */
.table-responsive {
    overflow-x: auto; /* Faz com que a tabela seja rolável se necessário */
    -webkit-overflow-scrolling: touch;
}

</style>

<body>
    <div class="dashboard-container">
        <!-- Barra lateral -->
        <%- include('partials/barraLateral') %>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Visão Geral do Estoque</h1>
            </div>
            
            <!-- Cards de Resumo -->
            <div class="cards">
                <div class="card">
                    <h3>Total de Produtos</h3>
                    <p id="total-produtos"></p>
                </div>
                <div class="card">
                    <h3>Produtos Vendidos</h3>
                    <p id="sold-products">120</p>
                </div>
                <div class="card">
                    <h3>Produtos em Falta</h3>
                    <p id="out-of-stock">30</p>
                </div>
            </div>
            
            <!-- Gráficos -->
            <div class="charts">
                <div class="chart-container">
                    <canvas id="stockChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>

            <!-- DataTable -->
            <div class="table-responsive"> <!-- Adicionando a classe para rolagem -->
                <table id="Datatable" class="table table-striped table-nowrap table-bordered align-middle mb-0">
                    <thead>
                        <tr>
                            <th>PRODUTO</th>
                            <th>MARCA</th>
                            <th>COR</th>
                            <th>VALOR</th>
                            <th>QUANTIDADE</th>
                            <th>MEDIDA</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

<script>

// Gráfico de Estoque
const ctxStock = document.getElementById('stockChart').getContext('2d');
const stockChart = new Chart(ctxStock, {
    type: 'bar',
    data: {
        labels: ['Produto A', 'Produto B', 'Produto C', 'Produto D'],
        datasets: [{
            label: 'Estoque Atual',
            data: [30, 45, 60, 25],  // Quantidade de estoque
            backgroundColor: 'rgba(33, 150, 243, 0.6)',
            borderColor: '#2196F3',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Gráfico de Vendas
const ctxSales = document.getElementById('salesChart').getContext('2d');
const salesChart = new Chart(ctxSales, {
    type: 'line',
    data: {
        labels: ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4'],
        datasets: [{
            label: 'Vendas Realizadas',
            data: [200, 300, 250, 450],  // Vendas ao longo do tempo
            borderColor: '#FF9800',
            backgroundColor: 'rgba(255, 152, 0, 0.2)',
            borderWidth: 2,
            fill: true
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});



function totalProdutosEstoque(){
    const id_empresa = sessionStorage.getItem('id_empresa')

    $.ajax({
        url: `/totalProdutos/${id_empresa}`,
        method: 'GET',
        contentType: 'application/json',
    }).done((response)=>{
        if(response){
            const valor = response
        }
    })
}

function sessao() {
    const id_empresa = sessionStorage.getItem('id_empresa');
    
    // Verifica se id_empresa não existe ou está vazio
    if (!id_empresa) {
        window.location.href = '/' ;  // Redireciona para a página de login
    }
}


$(document).ready(function(){
    const id_empresa = sessionStorage.getItem('id_empresa')
    $('#Datatable').DataTable({
        pageLength: 5,
        processing: true,
        serverSide: false,
        searching: false,
        info: true,
        ordering: false,
        pagingType: 'simple_numbers',
        lengthChange: false,
        autoWidth: false,
        language: {
            sProcessing: "Processando...",
            sLengthMenu: "Exibir _MENU_ registros por página",
            sZeroRecords: "Nenhum resultado encontrado",
            sEmptyTable: "Nenhum resultado encontrado",
            sInfo: "Exibindo do _START_ até _END_ de um total de _TOTAL_ registros",
            sInfoEmpty: "Exibindo do 0 até 0 de um total de 0 registros",
            sInfoFiltered: "(Filtrado de um total de _MAX_ registros)",
            sSearch: "Buscar:",
            sLoadingRecords: "Carregando...",
            oPaginate:{
                sFirst: "Primeiro",
                sLast: "Último",
                sNext: "Próximo",
                sPrevious: "Anterior"
            },
            oAria: {
                sSortAscending: ": Ativar para ordenar a coluna de maneira ascendente",
                sSortDescending: ": Ativar para ordenar a coluna de maneira descendente"
            }
        },
        ajax:{
            url: `/populaDatatable/${id_empresa}`,
            dataSrc: 'data'
        },
        columnDefs: [
            { width: "3%", targets: 0, className: 'text-center' }, // PRODUTO
            { width: "7%", targets: 1, className: 'text-center' }, // MARCA
            { width: "7%", targets: 2, className: 'text-center' }, // COR
            { width: "7%", targets: 3, className: 'text-center' }, // VALOR
            { width: "5%", targets: 4, className: 'text-center' }, // QUANTIDADE
            { width: "5%", targets: 5, className: 'text-center' } // MEDIDA
            
        ],
        columns:[
            {data: 'produto'},
            {data: 'marca'},
            {data: 'cor'},
            {data: 'valor'},
            {data: 'quantidade'},
            {data: 'medida'}
        ]
    })
})

// Verifica a cada 2 segundos
setInterval(() => {
    sessao();
}, 1000);


    </script>
</body>

</html>